<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pink Firework Splash</title>
    <style>
        /* Basic page setup */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevents scrollbars */
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            
            /* Cursors and touch feedback */
            cursor: pointer;
            -webkit-tap-highlight-color: transparent; /* Removes blue flash on tap */
        }

        /* Initial prompt text */
        #prompt {
            color: #444;
            text-align: center;
            margin-top: 45vh;
            font-size: 1.2rem;
            user-select: none; /* Prevents text selection */
            animation: fadeIn 2s ease-in-out;
            /* Make sure prompt doesn't block clicks */
            pointer-events: none; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- RECTANGLE SAVE BUTTON STYLES --- */
        #save-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        /* Rectangle Button Base */
        #saveButton {
            position: relative;
            width: 160px; /* Rectangle width */
            height: 48px; /* Rectangle height */
            background-color: #FF1493; /* Deep Pink background */
            border: 2px solid white;
            border-radius: 8px; /* Rounded corners */
            cursor: pointer;
            padding: 0;
            outline: none;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex; 
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* Text styling */
        #saveButton span {
            color: white;
            font-size: 1rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        #saveButton:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.9); /* Pink glow on hover */
        }
        
        /* Remove heart pseudo-elements if they were used */
        #saveButton::before,
        #saveButton::after {
            content: none;
        }
        /* --- END RECTANGLE SAVE BUTTON STYLES --- */


        /* Styling for the permanent color splash (40px, half size) */
        .color-splash {
            position: absolute; 
            width: 40px; 
            height: 40px;
            border-radius: 50%; /* Makes it circular */
            background-color: var(--splash-color); /* Color set by JS */
            opacity: 0; /* Start hidden */
            transform: translate(-50%, -50%) scale(0.1); /* Start small and centered */
            animation: splashIn 1s ease-out forwards;
            user-select: none; 
            pointer-events: none; 
            mix-blend-mode: screen; /* Makes colors blend nicely on black background */
        }
        
        /* Animation for the splash to grow and fade in */
        @keyframes splashIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.1);
            }
            50% {
                opacity: 0.6; /* Max opacity */
                transform: translate(-50%, -50%) scale(1.2); /* Slight overshoot */
            }
            100% {
                opacity: 0.4; /* Final opacity, slightly transparent */
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Styling for each particle (The Firework Burst) */
        .particle {
            position: absolute; 
            font-size: 1.5rem; 
            font-weight: bold;
            user-select: none; 
            pointer-events: none; 
            
            /* The burst animation */
            animation: burst 1.0s ease-out forwards;
        }

        /* This animation makes the particle burst outwards */
        @keyframes burst {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                /* Use CSS variables set by JS for the final random position */
                transform: translate(calc(var(--tx) - 50%), calc(var(--ty) - 50%)) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <p id="prompt">Tap and drag or click and hold to paint with pink firework splashes!</p>

    <div id="save-container">
        <button id="saveButton" title="Save Drawing">
            <span>SAVE DRAWING</span>
        </button>
    </div>

    <script>
        // --- Setup ---
        const targetWord = "Yoselin"; 
        let letterIndex = 0; 

        const particleCount = 20; 
        const burstRadius = 160;   

        // Pinkish colors only!
        const colors = [
            '#FFC0CB', // Pink
            '#FF69B4', // Hot Pink
            '#FF1493', // Deep Pink
            '#DA70D6', // Orchid
            '#EE82EE', // Violet
            '#C71585', // Medium Violet Red
            '#DB7093'  // Pale Violet Red
        ];

        let firstClick = true;
        const promptEl = document.getElementById('prompt');

        // --- Dragging State and Throttling ---
        let isDrawing = false;
        let lastEffectTime = 0;
        const throttleDelay = 50; 
        
        /**
         * Converts hex color string to an RGBA object for canvas drawing.
         * @param {string} hex - The hex color (e.g., #FF1493)
         * @param {number} alpha - The opacity (0.0 to 1.0)
         * @returns {string} RGBA color string
         */
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.substring(1, 3), 16);
            const g = parseInt(hex.substring(3, 5), 16);
            const b = parseInt(hex.substring(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        /**
         * Main function to create a firework burst and a color splash
         */
        function createEffect(x, y) {
            if (firstClick) {
                promptEl.style.display = 'none';
                firstClick = false;
            }

            const currentLetter = targetWord[letterIndex]; 
            const currentColor = colors[Math.floor(Math.random() * colors.length)]; 

            // --- 1. Create the PERMANENT color splash ---
            const splash = document.createElement('div');
            splash.className = 'color-splash';
            // Set the color as a CSS variable for the mix-blend-mode to work correctly
            splash.style.setProperty('--splash-color', currentColor); 
            splash.style.left = `${x}px`;
            splash.style.top = `${y}px`;
            document.body.appendChild(splash);
            
            // --- 2. Create the TEMPORARY burst of particles (The Firework) ---
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = currentLetter; 
                particle.style.color = currentColor;

                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;

                // Calculate a random destination for the particle
                const angle = Math.random() * Math.PI * 2; 
                const radius = Math.random() * burstRadius; 
                const tx = Math.cos(angle) * radius;
                const ty = Math.sin(angle) * radius;

                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);

                particle.addEventListener('animationend', () => {
                    particle.remove();
                });
                
                document.body.appendChild(particle);
            }

            letterIndex = (letterIndex + 1) % targetWord.length;
        }

        // --- Save Functionality ---
        const saveButton = document.getElementById('saveButton');
        
        function saveDrawing() {
            const splashes = document.querySelectorAll('.color-splash');
            
            // If no splashes exist, do nothing
            if (splashes.length === 0) {
                console.log("Nothing to save! Make a drawing first.");
                return;
            }

            // Create a temporary canvas
            const canvas = document.createElement('canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d');

            // 1. Draw the black background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw each splash onto the canvas
            splashes.forEach(splash => {
                // Get position (convert 'px' string to number)
                const x = parseFloat(splash.style.left);
                const y = parseFloat(splash.style.top);
                
                // Get color (read from the CSS variable)
                const color = splash.style.getPropertyValue('--splash-color');
                
                // Splash size is 40px width/height, so radius is 20px
                const radius = 20; 
                // Final opacity from splashIn keyframes is 0.4
                const opacity = 0.4; 
                
                ctx.beginPath();
                
                // Set context style using RGBA for proper transparency
                ctx.fillStyle = hexToRgba(color, opacity);

                // Draw the circle (centered)
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            });

            // 3. Convert to PNG and trigger download
            const imageURL = canvas.toDataURL('image/png');
            
            const a = document.createElement('a');
            a.href = imageURL;
            a.download = `pink_splash_drawing_${Date.now()}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            console.log(`Drawing saved successfully as ${a.download}`);
        }

        saveButton.addEventListener('click', (e) => {
            // Prevent the save button click from triggering a drawing effect
            e.stopPropagation(); 
            
            // Provide visual feedback (down-scale the button)
            saveButton.style.transform = 'scale(0.9)';
            
            // Perform save and revert button scale after a brief delay
            setTimeout(() => {
                saveDrawing();
                saveButton.style.transform = 'scale(1)';
            }, 100);
        });
        // --- End Save Functionality ---


        // --- Event Listeners for Drawing ---
        
        document.addEventListener('pointerdown', (e) => {
            // Check if the click is on the document body and not the save button
            if (e.isPrimary && e.target.id !== 'saveButton' && e.target.parentElement.id !== 'save-container') {
                isDrawing = true;
                // Capture the pointer to ensure moves are tracked smoothly
                document.body.setPointerCapture(e.pointerId); 
                createEffect(e.clientX, e.clientY);
            }
        });

        document.addEventListener('pointermove', (e) => {
            if (isDrawing && e.isPrimary) {
                const currentTime = Date.now();
                if (currentTime - lastEffectTime > throttleDelay) {
                    createEffect(e.clientX, e.clientY);
                    lastEffectTime = currentTime;
                }
            }
        });

        document.addEventListener('pointerup', (e) => {
            if (e.isPrimary) {
                isDrawing = false;
                document.body.releasePointerCapture(e.pointerId);
            }
        });

    </script>
</body>
</html>
